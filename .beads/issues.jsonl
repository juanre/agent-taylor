{"id":"agent-taylor-14r","title":"Add --log-bundle CLI flag and env var support","description":"Add `--log-bundle` flag and `AGENT_TAYLOR_LOG_BUNDLE` env var to CLI.\n\n## New CLI Argument\n\n```python\ncompare.add_argument(\n    \"--log-bundle\",\n    default=None,\n    help=\"Directory containing machine subdirs with claude/ and codex/ logs. \"\n         \"Overrides --claude-dir and --codex-dir. \"\n         \"Can also be set via AGENT_TAYLOR_LOG_BUNDLE env var.\",\n)\n```\n\n## Priority Order\n\n1. `--log-bundle` CLI flag (highest priority)\n2. `AGENT_TAYLOR_LOG_BUNDLE` environment variable\n3. Config file `log_bundle` setting\n4. Default: use `~/.claude` and `~/.codex`\n\n## Implementation in _cmd_compare()\n\n```python\nimport os\n\ndef _cmd_compare(ns: argparse.Namespace) -\u003e int:\n    # Resolve log bundle from CLI, env, or config\n    log_bundle: Optional[Path] = None\n    \n    if ns.log_bundle:\n        log_bundle = Path(ns.log_bundle).expanduser()\n    elif os.environ.get(\"AGENT_TAYLOR_LOG_BUNDLE\"):\n        log_bundle = Path(os.environ[\"AGENT_TAYLOR_LOG_BUNDLE\"]).expanduser()\n    elif config.log_bundle:  # from paths.toml\n        log_bundle = config.log_bundle\n    \n    # Pass to collection functions\n    interactions = collect_interactions(\n        log_bundle=log_bundle,\n        claude_dir=claude_dir if not log_bundle else None,\n        codex_dir=codex_dir if not log_bundle else None,\n    )\n```\n\n## Deprecation of --claude-dir and --codex-dir\n\nWhen `--log-bundle` is used, `--claude-dir` and `--codex-dir` are ignored. Consider:\n- Printing a warning if both are specified\n- Or keeping them for default mode only\n\n## Usage Examples\n\n```bash\n# Use env var (most common for multi-machine setup)\nexport AGENT_TAYLOR_LOG_BUNDLE=~/Documents/agent-logs\nagent-taylor compare --author \"Juan\"\n\n# Or explicit CLI\nagent-taylor compare --author \"Juan\" --log-bundle ~/Documents/agent-logs\n\n# Default mode (single machine)\nagent-taylor compare --author \"Juan\"\n```","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:12:13.53971+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:41:37.761769+01:00","dependencies":[{"issue_id":"agent-taylor-14r","depends_on_id":"agent-taylor-8ce","type":"blocks","created_at":"2026-01-13T09:12:26.307784+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-14r","depends_on_id":"agent-taylor-55n","type":"blocks","created_at":"2026-01-13T09:12:26.379205+01:00","created_by":"Juan Reyero"}]}
{"id":"agent-taylor-3ap","title":"Update README with log bundle documentation","description":"Update README.md to document the log bundle feature for multi-machine setups.\n\n## New Section: Multi-Machine Setup\n\n```markdown\n## Multi-Machine Setup\n\nIf you work on multiple computers, you can aggregate logs from all machines into a single \"log bundle\" directory.\n\n### Log Bundle Structure\n\n\\`\\`\\`\n~/Documents/agent-logs/\n├── laptop/\n│   ├── claude/          # Copied from ~/.claude on laptop\n│   └── codex/           # Copied from ~/.codex on laptop\n├── desktop/\n│   ├── claude/\n│   └── codex/\n└── old-machine/\n    └── claude/          # codex/ optional\n\\`\\`\\`\n\n### Configuration\n\nSet the bundle location via environment variable (recommended):\n\\`\\`\\`bash\nexport AGENT_TAYLOR_LOG_BUNDLE=~/Documents/agent-logs\n\\`\\`\\`\n\nOr via CLI flag:\n\\`\\`\\`bash\nagent-taylor compare --author \"Your Name\" --log-bundle ~/Documents/agent-logs\n\\`\\`\\`\n\nOr in config file (`~/.config/agent-taylor/paths.toml`):\n\\`\\`\\`toml\nlog_bundle = \"~/Documents/agent-logs\"\n\\`\\`\\`\n\n### Syncing Local Logs\n\nAfter a work session, sync your local logs to the bundle:\n\\`\\`\\`bash\nagent-taylor sync\n\\`\\`\\`\n\nThis copies `~/.claude` and `~/.codex` to `\u003cbundle\u003e/\u003chostname\u003e/`.\n\n### Usage\n\n\\`\\`\\`bash\n# With env var set, just run compare as usual\nagent-taylor compare --author \"Your Name\"\n\\`\\`\\`\n\nThe tool automatically discovers all machines in the bundle and aggregates their logs.\n\\`\\`\\`\n\n## Update Existing Sections\n\n- Update CLI reference for new flags\n- Update config file documentation\n- Add sync command reference","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:12:50.131969+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:44:53.580735+01:00","dependencies":[{"issue_id":"agent-taylor-3ap","depends_on_id":"agent-taylor-lks","type":"blocks","created_at":"2026-01-13T09:12:54.133247+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-3ap","depends_on_id":"agent-taylor-14r","type":"blocks","created_at":"2026-01-13T09:12:54.217952+01:00","created_by":"Juan Reyero"}]}
{"id":"agent-taylor-55n","title":"Add log bundle discovery to detect_source_date_ranges()","description":"Modify `detect_source_date_ranges()` in `ai_hours.py` to support log bundle discovery.\n\n## Current Signature\n```python\ndef detect_source_date_ranges(\n    claude_dir: Optional[Path] = None,\n    codex_dir: Optional[Path] = None,\n) -\u003e dict[str, Optional[str]]:\n```\n\n## Target Signature\n```python\ndef detect_source_date_ranges(\n    log_bundle: Optional[Path] = None,\n    claude_dir: Optional[Path] = None,\n    codex_dir: Optional[Path] = None,\n) -\u003e dict[str, Optional[str]]:\n```\n\n## Behavior\n\n**When `log_bundle` is provided:**\n1. Discover all `\u003cbundle\u003e/\u003cmachine\u003e/claude` and `\u003cbundle\u003e/\u003cmachine\u003e/codex` directories\n2. Find earliest timestamp across ALL claude directories → \"claude\" date\n3. Find earliest timestamp across ALL codex directories → \"codex\" date\n\n**When `log_bundle` is None:**\n- Current behavior: check single `claude_dir` and `codex_dir`\n\n## Implementation\n\nReuse `_discover_bundle_sources()` from collect_interactions task, then:\n```python\nif log_bundle:\n    claude_dirs, codex_dirs = _discover_bundle_sources(log_bundle)\n    # Find min timestamp across all claude_dirs\n    claude_timestamps = [_earliest_claude_timestamp(d) for d in claude_dirs]\n    claude_ts = min((t for t in claude_timestamps if t), default=None)\n    # Same for codex\n```\n\nThe existing `_earliest_claude_timestamp()` and `_earliest_codex_timestamp()` helpers work on single dirs and can be reused.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:08:39.455592+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:53:27.005757+01:00","closed_at":"2026-01-13T09:53:27.005757+01:00","close_reason":"Implemented log bundle discovery support with comprehensive tests"}
{"id":"agent-taylor-894","title":"Implement log sync command","description":"Implement a command to sync local logs to a log bundle directory.\n\n## Command\n\n```bash\nagent-taylor sync [--bundle ~/Documents/agent-logs] [--machine-name hostname]\n```\n\n## Behavior\n\n1. Determine bundle location (CLI flag, env var, or config)\n2. Determine machine name (CLI flag, or `hostname` command)\n3. Create `\u003cbundle\u003e/\u003cmachine\u003e/` if needed\n4. Copy/sync:\n   - `~/.claude/` → `\u003cbundle\u003e/\u003cmachine\u003e/claude/`\n   - `~/.codex/` → `\u003cbundle\u003e/\u003cmachine\u003e/codex/`\n\n## Sync Strategy Options\n\n### Option A: Full copy with rsync\n```python\nimport subprocess\nsubprocess.run([\"rsync\", \"-av\", \"--delete\", \n    str(Path.home() / \".claude\") + \"/\",\n    str(bundle / machine_name / \"claude\") + \"/\"])\n```\nPros: Robust, handles deletions\nCons: Requires rsync\n\n### Option B: Python shutil\n```python\nimport shutil\nshutil.copytree(src, dst, dirs_exist_ok=True)\n```\nPros: No external dependency\nCons: Doesn't handle deletions, may be slower\n\n### Option C: Incremental copy (only new files)\nCopy only files that don't exist or are newer in source.\nPros: Fast for regular syncs\nCons: More complex\n\n**Recommendation**: Option A (rsync) with fallback to Option B if rsync unavailable.\n\n## CLI Arguments\n\n```python\nsync = sub.add_parser(\"sync\", help=\"Sync local logs to bundle directory.\")\nsync.add_argument(\n    \"--bundle\",\n    default=None,\n    help=\"Bundle directory (default: from env/config).\",\n)\nsync.add_argument(\n    \"--machine-name\",\n    default=None,\n    help=\"Machine name subdirectory (default: hostname).\",\n)\n```\n\n## Usage\n\n```bash\n# One-time setup on each machine\nexport AGENT_TAYLOR_LOG_BUNDLE=~/Documents/agent-logs\n\n# After a work session, sync local logs to bundle\nagent-taylor sync\n\n# Or with explicit machine name\nagent-taylor sync --machine-name laptop\n```\n\n## Notes\n\n- Logs are append-only JSONL - safe to sync without conflicts\n- Session UUIDs ensure no filename collisions\n- Consider: should this also pull from remote machines? Probably not - keep it simple","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:36:52.885435+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:44:26.980296+01:00"}
{"id":"agent-taylor-8ce","title":"Add log bundle discovery to collect_interactions()","description":"Modify `collect_interactions()` in `ai_hours.py` to support log bundle discovery.\n\n## Current Signature\n```python\ndef collect_interactions(\n    claude_dir: Optional[Path] = None,\n    codex_dir: Optional[Path] = None,\n) -\u003e list[Interaction]:\n```\n\n## Target Signature\n```python\ndef collect_interactions(\n    log_bundle: Optional[Path] = None,\n    claude_dir: Optional[Path] = None,\n    codex_dir: Optional[Path] = None,\n) -\u003e list[Interaction]:\n```\n\n## Behavior\n\n**When `log_bundle` is provided:**\n1. Discover all first-level subdirectories (machine names)\n2. For each machine dir, look for `claude/` and `codex/` subdirs\n3. Parse all discovered directories\n4. Ignore `claude_dir` and `codex_dir` parameters\n\n**When `log_bundle` is None (default mode):**\n- Use `claude_dir` (default `~/.claude`) and `codex_dir` (default `~/.codex`)\n- Current behavior preserved\n\n## Discovery Logic\n\n```python\ndef _discover_bundle_sources(bundle: Path) -\u003e tuple[list[Path], list[Path]]:\n    \"\"\"Discover claude and codex directories in a log bundle.\"\"\"\n    claude_dirs: list[Path] = []\n    codex_dirs: list[Path] = []\n    \n    for machine_dir in bundle.iterdir():\n        if not machine_dir.is_dir():\n            continue\n        claude_subdir = machine_dir / \"claude\"\n        if claude_subdir.is_dir():\n            claude_dirs.append(claude_subdir)\n        codex_subdir = machine_dir / \"codex\"\n        if codex_subdir.is_dir():\n            codex_dirs.append(codex_subdir)\n    \n    return claude_dirs, codex_dirs\n```\n\n## Internal Changes\n\nThe existing `_parse_claude_sessions()` and `_parse_codex_sessions()` work on single directories. Either:\n- Option A: Call them multiple times and combine results\n- Option B: Make them accept lists internally\n\nRecommendation: Option A - keep parsers simple, combine at `collect_interactions()` level.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:08:29.927749+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:53:26.979691+01:00","closed_at":"2026-01-13T09:53:26.979691+01:00","close_reason":"Implemented log bundle discovery support with comprehensive tests"}
{"id":"agent-taylor-biy","title":"Multi-machine log aggregation","description":"Support aggregating AI assistant logs from multiple machines via a structured log bundle directory.\n\n## Log Bundle Structure\n\nA log bundle is a directory containing subdirectories for each machine, each with `claude/` and `codex/` subdirs:\n\n```\n~/Documents/agent-logs/          # log bundle root\n├── altair/\n│   ├── claude/                  # Claude Code logs (not .claude)\n│   └── codex/                   # Codex logs (not .codex)\n├── antares/\n│   ├── claude/\n│   └── codex/\n└── old/\n    └── claude/                  # codex/ optional\n```\n\n## Operating Modes\n\n1. **Default mode** (no bundle specified): Read from `~/.claude` and `~/.codex`\n2. **Bundle mode**: Read ONLY from the bundle, auto-discover all `\u003cbundle\u003e/\u003cmachine\u003e/{claude,codex}` directories\n\n## Configuration (priority order)\n\n1. CLI: `--log-bundle ~/Documents/agent-logs`\n2. Env var: `AGENT_TAYLOR_LOG_BUNDLE`\n3. Config file: `log_bundle = \"~/Documents/agent-logs\"`\n\n## Sync Strategy\n\nSeparate from reading: a mechanism to copy local logs to the bundle:\n- `~/.claude` → `\u003cbundle\u003e/\u003chostname\u003e/claude`\n- `~/.codex` → `\u003cbundle\u003e/\u003chostname\u003e/codex`\n\n## Data Observations\n\nFrom `~/Documents/agent-logs`:\n- **altair**: Jan 9-12, 2026 (claude + codex)\n- **antares**: Dec 13, 2025 - Jan 11, 2026 (claude + codex)\n- **old**: Sep 27 - Oct 26, 2025 (claude only)\n\nSession files use UUIDs - no collisions across machines.","status":"open","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:08:18.754549+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:41:02.5218+01:00","dependencies":[{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-8ce","type":"blocks","created_at":"2026-01-13T09:08:39.250473+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-55n","type":"blocks","created_at":"2026-01-13T09:08:49.942268+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-14r","type":"blocks","created_at":"2026-01-13T09:12:26.23496+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-lks","type":"blocks","created_at":"2026-01-13T09:12:38.573535+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-kq6","type":"blocks","created_at":"2026-01-13T09:12:49.717664+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-3ap","type":"blocks","created_at":"2026-01-13T09:12:54.054758+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-biy","depends_on_id":"agent-taylor-894","type":"blocks","created_at":"2026-01-13T09:37:07.459897+01:00","created_by":"Juan Reyero"}]}
{"id":"agent-taylor-kq6","title":"Add tests for log bundle discovery","description":"Add comprehensive tests for log bundle discovery and multi-machine log collection.\n\n## Test Cases for Bundle Discovery\n\n### _discover_bundle_sources()\n1. **Basic discovery**\n   - Bundle with 2 machines, each having claude/ and codex/\n   - Verify returns correct lists of paths\n\n2. **Partial machines**\n   - Machine with only claude/ (no codex/)\n   - Verify codex list doesn't include this machine\n\n3. **Empty bundle**\n   - Bundle directory exists but is empty\n   - Verify returns empty lists\n\n4. **Non-directory entries**\n   - Bundle contains files (not just directories)\n   - Verify files are ignored\n\n## Test Cases for collect_interactions()\n\n### Bundle mode\n1. **Multiple machines with logs**\n   - Create bundle with altair/, antares/, old/\n   - Each with session files\n   - Verify all interactions collected and sorted\n\n2. **Bundle overrides single dirs**\n   - Pass both log_bundle and claude_dir\n   - Verify only bundle is used\n\n### Default mode (log_bundle=None)\n3. **Single machine behavior preserved**\n   - No bundle, use claude_dir and codex_dir\n   - Verify existing tests still pass\n\n## Test Cases for detect_source_date_ranges()\n\n1. **Bundle with different dates per machine**\n   - altair: claude starts 2026-01-09\n   - antares: claude starts 2025-12-13\n   - old: claude starts 2025-09-27\n   - Verify returns earliest: 2025-09-27\n\n2. **Bundle with mixed sources**\n   - Some machines have codex, some don't\n   - Verify codex date only from machines that have it\n\n## Test Cases for CLI\n\n1. **--log-bundle flag**\n   - Verify bundle path is used\n\n2. **Environment variable**\n   - Set AGENT_TAYLOR_LOG_BUNDLE\n   - Verify it's picked up when no CLI flag\n\n3. **Config file**\n   - Config has log_bundle\n   - Verify used when no CLI or env var\n\n4. **Priority order**\n   - CLI \u003e env \u003e config\n   - Verify correct precedence\n\n## Fixture: create_log_bundle\n\n```python\n@pytest.fixture\ndef log_bundle(tmp_path: Path) -\u003e Path:\n    \"\"\"Create a log bundle with multiple machines.\"\"\"\n    bundle = tmp_path / \"agent-logs\"\n    \n    # Create altair with claude and codex\n    (bundle / \"altair\" / \"claude\" / \"projects\" / \"-test-proj\").mkdir(parents=True)\n    (bundle / \"altair\" / \"codex\" / \"sessions\" / \"2026\" / \"01\").mkdir(parents=True)\n    \n    # Create antares with claude only\n    (bundle / \"antares\" / \"claude\" / \"projects\" / \"-test-proj\").mkdir(parents=True)\n    \n    return bundle\n```","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:12:38.923367+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:44:43.207776+01:00","dependencies":[{"issue_id":"agent-taylor-kq6","depends_on_id":"agent-taylor-8ce","type":"blocks","created_at":"2026-01-13T09:12:49.791637+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-kq6","depends_on_id":"agent-taylor-55n","type":"blocks","created_at":"2026-01-13T09:12:49.865255+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-kq6","depends_on_id":"agent-taylor-14r","type":"blocks","created_at":"2026-01-13T09:12:49.942903+01:00","created_by":"Juan Reyero"}]}
{"id":"agent-taylor-lks","title":"Add log_bundle to config file","description":"Add `log_bundle` setting to paths.toml config file.\n\n## Updated Config Format\n\nIn `~/.config/agent-taylor/paths.toml`:\n```toml\n# Log bundle directory containing machine subdirs\nlog_bundle = \"~/Documents/agent-logs\"\n\n[remap]\n\"/old/path\" = \"/new/path\"\n\n[ignore]\npaths = [\"/tmp\"]\n```\n\n## Implementation\n\n1. Update `PathConfig` dataclass in `repo_detection.py`:\n```python\n@dataclass\nclass PathConfig:\n    remap: dict[str, str]\n    ignore_paths: list[str]\n    log_bundle: Optional[Path] = None  # NEW\n```\n\n2. Update `load_path_config()` to parse `log_bundle`:\n```python\nlog_bundle_str = config.get(\"log_bundle\")\nlog_bundle = Path(log_bundle_str).expanduser() if log_bundle_str else None\n```\n\n## Priority\n\nConfig file has lowest priority:\n1. CLI `--log-bundle`\n2. Env var `AGENT_TAYLOR_LOG_BUNDLE`\n3. Config file `log_bundle`\n4. Default mode (`~/.claude`, `~/.codex`)\n\n## Path Expansion\n\n- Support `~` expansion\n- Relative paths resolved relative to CWD (not config file location)","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-13T09:12:26.57999+01:00","created_by":"Juan Reyero","updated_at":"2026-01-13T09:41:46.545059+01:00","dependencies":[{"issue_id":"agent-taylor-lks","depends_on_id":"agent-taylor-8ce","type":"blocks","created_at":"2026-01-13T09:12:38.651504+01:00","created_by":"Juan Reyero"},{"issue_id":"agent-taylor-lks","depends_on_id":"agent-taylor-55n","type":"blocks","created_at":"2026-01-13T09:12:38.727257+01:00","created_by":"Juan Reyero"}]}
